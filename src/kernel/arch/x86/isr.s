.code32
.intel_syntax noprefix
.align 4


.section .text

.macro NOERROR_HANDLER num
.global i686_ISR\num
i686_ISR\num:
    push 0
    push \num
    jmp i686_common

.endm

.macro ERROR_HANDLER num
.global i686_ISR\num
i686_ISR\num:
    push \num
    jmp i686_common

.endm



NOERROR_HANDLER 0
NOERROR_HANDLER 1
NOERROR_HANDLER 2
NOERROR_HANDLER 3
NOERROR_HANDLER 4
NOERROR_HANDLER 5
NOERROR_HANDLER 6
NOERROR_HANDLER 7
ERROR_HANDLER 8             // 8 has an error code
NOERROR_HANDLER 9
ERROR_HANDLER 10            // 10 has an error code
ERROR_HANDLER 11            // 11 has an error code
ERROR_HANDLER 12            // 12 has an error code
ERROR_HANDLER 13            // 13 has an error code
ERROR_HANDLER 14            // 14 has an error code
NOERROR_HANDLER 15
NOERROR_HANDLER 16
ERROR_HANDLER 17            // 17 has an error code
NOERROR_HANDLER 18
NOERROR_HANDLER 19
NOERROR_HANDLER 20
ERROR_HANDLER 21            // 21 has an error code
NOERROR_HANDLER 22
NOERROR_HANDLER 23
NOERROR_HANDLER 24
NOERROR_HANDLER 25
NOERROR_HANDLER 26
NOERROR_HANDLER 27
NOERROR_HANDLER 28
ERROR_HANDLER 29            // 29 has an error code
ERROR_HANDLER 30            // 30 has an error code
NOERROR_HANDLER 31
NOERROR_HANDLER 32
NOERROR_HANDLER 33
NOERROR_HANDLER 34
NOERROR_HANDLER 35
NOERROR_HANDLER 36
NOERROR_HANDLER 37
NOERROR_HANDLER 38
NOERROR_HANDLER 39
NOERROR_HANDLER 40
NOERROR_HANDLER 41
NOERROR_HANDLER 42
NOERROR_HANDLER 43
NOERROR_HANDLER 44
NOERROR_HANDLER 45
NOERROR_HANDLER 46
NOERROR_HANDLER 47
NOERROR_HANDLER 48
NOERROR_HANDLER 49
NOERROR_HANDLER 50
NOERROR_HANDLER 51
NOERROR_HANDLER 52
NOERROR_HANDLER 53
NOERROR_HANDLER 54
NOERROR_HANDLER 55
NOERROR_HANDLER 56
NOERROR_HANDLER 57
NOERROR_HANDLER 58
NOERROR_HANDLER 59
NOERROR_HANDLER 60
NOERROR_HANDLER 61
NOERROR_HANDLER 62
NOERROR_HANDLER 63
NOERROR_HANDLER 64
NOERROR_HANDLER 65
NOERROR_HANDLER 66
NOERROR_HANDLER 67
NOERROR_HANDLER 68
NOERROR_HANDLER 69
NOERROR_HANDLER 70
NOERROR_HANDLER 71
NOERROR_HANDLER 72
NOERROR_HANDLER 73
NOERROR_HANDLER 74
NOERROR_HANDLER 75
NOERROR_HANDLER 76
NOERROR_HANDLER 77
NOERROR_HANDLER 78
NOERROR_HANDLER 79
NOERROR_HANDLER 80
NOERROR_HANDLER 81
NOERROR_HANDLER 82
NOERROR_HANDLER 83
NOERROR_HANDLER 84
NOERROR_HANDLER 85
NOERROR_HANDLER 86
NOERROR_HANDLER 87
NOERROR_HANDLER 88
NOERROR_HANDLER 89
NOERROR_HANDLER 90
NOERROR_HANDLER 91
NOERROR_HANDLER 92
NOERROR_HANDLER 93
NOERROR_HANDLER 94
NOERROR_HANDLER 95
NOERROR_HANDLER 96
NOERROR_HANDLER 97
NOERROR_HANDLER 98
NOERROR_HANDLER 99
NOERROR_HANDLER 100
NOERROR_HANDLER 101
NOERROR_HANDLER 102
NOERROR_HANDLER 103
NOERROR_HANDLER 104
NOERROR_HANDLER 105
NOERROR_HANDLER 106
NOERROR_HANDLER 107
NOERROR_HANDLER 108
NOERROR_HANDLER 109
NOERROR_HANDLER 110
NOERROR_HANDLER 111
NOERROR_HANDLER 112
NOERROR_HANDLER 113
NOERROR_HANDLER 114
NOERROR_HANDLER 115
NOERROR_HANDLER 116
NOERROR_HANDLER 117
NOERROR_HANDLER 118
NOERROR_HANDLER 119
NOERROR_HANDLER 120
NOERROR_HANDLER 121
NOERROR_HANDLER 122
NOERROR_HANDLER 123
NOERROR_HANDLER 124
NOERROR_HANDLER 125
NOERROR_HANDLER 126
NOERROR_HANDLER 127
NOERROR_HANDLER 128
NOERROR_HANDLER 129
NOERROR_HANDLER 130
NOERROR_HANDLER 131
NOERROR_HANDLER 132
NOERROR_HANDLER 133
NOERROR_HANDLER 134
NOERROR_HANDLER 135
NOERROR_HANDLER 136
NOERROR_HANDLER 137
NOERROR_HANDLER 138
NOERROR_HANDLER 139
NOERROR_HANDLER 140
NOERROR_HANDLER 141
NOERROR_HANDLER 142
NOERROR_HANDLER 143
NOERROR_HANDLER 144
NOERROR_HANDLER 145
NOERROR_HANDLER 146
NOERROR_HANDLER 147
NOERROR_HANDLER 148
NOERROR_HANDLER 149
NOERROR_HANDLER 150
NOERROR_HANDLER 151
NOERROR_HANDLER 152
NOERROR_HANDLER 153
NOERROR_HANDLER 154
NOERROR_HANDLER 155
NOERROR_HANDLER 156
NOERROR_HANDLER 157
NOERROR_HANDLER 158
NOERROR_HANDLER 159
NOERROR_HANDLER 160
NOERROR_HANDLER 161
NOERROR_HANDLER 162
NOERROR_HANDLER 163
NOERROR_HANDLER 164
NOERROR_HANDLER 165
NOERROR_HANDLER 166
NOERROR_HANDLER 167
NOERROR_HANDLER 168
NOERROR_HANDLER 169
NOERROR_HANDLER 170
NOERROR_HANDLER 171
NOERROR_HANDLER 172
NOERROR_HANDLER 173
NOERROR_HANDLER 174
NOERROR_HANDLER 175
NOERROR_HANDLER 176
NOERROR_HANDLER 177
NOERROR_HANDLER 178
NOERROR_HANDLER 179
NOERROR_HANDLER 180
NOERROR_HANDLER 181
NOERROR_HANDLER 182
NOERROR_HANDLER 183
NOERROR_HANDLER 184
NOERROR_HANDLER 185
NOERROR_HANDLER 186
NOERROR_HANDLER 187
NOERROR_HANDLER 188
NOERROR_HANDLER 189
NOERROR_HANDLER 190
NOERROR_HANDLER 191
NOERROR_HANDLER 192
NOERROR_HANDLER 193
NOERROR_HANDLER 194
NOERROR_HANDLER 195
NOERROR_HANDLER 196
NOERROR_HANDLER 197
NOERROR_HANDLER 198
NOERROR_HANDLER 199
NOERROR_HANDLER 200
NOERROR_HANDLER 201
NOERROR_HANDLER 202
NOERROR_HANDLER 203
NOERROR_HANDLER 204
NOERROR_HANDLER 205
NOERROR_HANDLER 206
NOERROR_HANDLER 207
NOERROR_HANDLER 208
NOERROR_HANDLER 209
NOERROR_HANDLER 210
NOERROR_HANDLER 211
NOERROR_HANDLER 212
NOERROR_HANDLER 213
NOERROR_HANDLER 214
NOERROR_HANDLER 215
NOERROR_HANDLER 216
NOERROR_HANDLER 217
NOERROR_HANDLER 218
NOERROR_HANDLER 219
NOERROR_HANDLER 220
NOERROR_HANDLER 221
NOERROR_HANDLER 222
NOERROR_HANDLER 223
NOERROR_HANDLER 224
NOERROR_HANDLER 225
NOERROR_HANDLER 226
NOERROR_HANDLER 227
NOERROR_HANDLER 228
NOERROR_HANDLER 229
NOERROR_HANDLER 230
NOERROR_HANDLER 231
NOERROR_HANDLER 232
NOERROR_HANDLER 233
NOERROR_HANDLER 234
NOERROR_HANDLER 235
NOERROR_HANDLER 236
NOERROR_HANDLER 237
NOERROR_HANDLER 238
NOERROR_HANDLER 239
NOERROR_HANDLER 240
NOERROR_HANDLER 241
NOERROR_HANDLER 242
NOERROR_HANDLER 243
NOERROR_HANDLER 244
NOERROR_HANDLER 245
NOERROR_HANDLER 246
NOERROR_HANDLER 247
NOERROR_HANDLER 248
NOERROR_HANDLER 249
NOERROR_HANDLER 250
NOERROR_HANDLER 251
NOERROR_HANDLER 252
NOERROR_HANDLER 253
NOERROR_HANDLER 254
NOERROR_HANDLER 255





i686_common:
    // Save current state
    pushad

    // Save current task's data segment
    xor eax, eax
    mov ax, ds
    push eax

    // Use kernel's data segment (to handle interrupt)
    mov ax, 0x10 // 0x10 - GDT offset for kernel data
    mov ds, ax
    mov es, ax
    mov fs, ax
    mov gs, ax

    // Call C handler for given interrupt
    push esp // Give C function a pointer to collected interrupt information
    call i686_ISR_Handler
    add esp, 4

    // Return to saved data segment
    pop eax
    mov ds, ax
    mov es, ax
    mov fs, ax
    mov gs, ax

    // Restore saved register values
    popad

    // Clean up interrupt data
    add esp, 8 // The 2 values for exception number and interrupt number

    // Lastly, exit interrupt
    iret
